<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>NSENDU</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="img1/favicon.png" rel="icon">
  <link href="img1/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="vendor1/aos/aos.css" rel="stylesheet">
  <link href="vendor1/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="vendor1/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="vendor1/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="vendor1/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="vendor1/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="css1/style.css" rel="stylesheet">
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top d-flex align-items-center">
    <div class="container d-flex justify-content-between">

      <div class="logo">
        <h1><a href="/">NSENDU</a></h1>
        <!-- Uncomment below if you prefer to use an image logo -->
        <!-- <a href="index.html"><img src="assets/img1/logo.png" alt="" class="img-fluid"></a> -->
      </div>

      <nav id="navbar" class="navbar">
        <ul>
          <li class="dropdown"><a href="#"><span id="walletAmount"> </span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              <li><a href="#">Deposit</a></li>
              <li><a href="#">Withdraw</a></li>
              <li><a href="#">Transaction History</a></li>
            </ul>
          </li>
          <li><a class="nav-link scrollto" href="#">Connect Wallet</a></li>
          <li><a class="nav-link scrollto" href="index.html">Go Back</a></li>
          <!-- <li class="dropdown"><a href="#"><span>Resources</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              <li><a href="#">Drop Down 1</a></li>
              <li class="dropdown"><a href="#"><span>Deep Drop Down</span> <i class="bi bi-chevron-right"></i></a>
                <ul>
                  <li><a href="#">Deep Drop Down 1</a></li>
                  <li><a href="#">Deep Drop Down 2</a></li>
                  <li><a href="#">Deep Drop Down 3</a></li>
                  <li><a href="#">Deep Drop Down 4</a></li>
                  <li><a href="#">Deep Drop Down 5</a></li>
                </ul>
              </li>
              <li><a href="#">Drop Down 2</a></li>
              <li><a href="#">Drop Down 3</a></li>
              <li><a href="#">Drop Down 4</a></li>
            </ul>
          </li>
          <li><a class="nav-link scrollto" href="aboutPage.html">About</a></li>
          <li><a class="nav-link scrollto" href="teamPage.html">Our People</a></li>
          <li><a class="nav-link scrollto" href="faqPage.html">FAQs</a></li>
          <li><a class="nav-link scrollto" href="contactPage.html">Contact</a></li> -->
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

  <!-- ======= Hero Section ======= -->
  <section id="hero" class="d-flex flex-column justify-content-center align-items-center">
    <div class="container text-center text-md-left" data-aos="fade-up">
      <h1>NSENDU...</h1>
      <h2></h2>
      <a href="/mint.html" class="btn-get-started scrollto">Mint</a>
      <a href="#" onclick="verify()" class="btn-get-started scrollto">Verify</a>
      <a href="#" class="btn-get-started scrollto">Report - Coming soon</a>
      <a href="#" class="btn-get-started scrollto">My assets - Coming soon</a>
    </div>
  </section><!-- End Hero -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="vendor1/aos/aos.js"></script>
  <script src="vendor1/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="vendor1/glightbox/js/glightbox.min.js"></script>
  <script src="vendor1/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="vendor1/swiper/swiper-bundle.min.js"></script>
  <script src="vendor1/php-email-form/validate.js"></script>
  <!-- JavaScript Files -->
  <script src="js1/main.js"></script>
  <script src="js/verify.js"></script>
  <!-- Import ethersjs source -->
  <script charset="utf-8" src="https://cdn.ethers.io/scripts/ethers-v4.min.js" type="text/javascript"></script>

  <script> 
  window.onload = (event) =>{ walletAmount(); } 
  </script>

  <script>
    // SPDX-License-Identifier: GPL-3.0

    pragma solidity >=0.8.2 <0.9.0;

    contract assetContract {
        
        mapping(string => address) ownershipLog;
        mapping(string => bool) mintLogs;
        mapping(string => address[]) transferLogs;
        mapping(string => uint) ownershipHistoryCount;

        function setItem (string calldata ID) public returns (string memory done) {
            require(ownershipLog[ID] != msg.sender, "This item has already been minted by you");
            require(mintLogs[ID] != true, "The item already belongs to an entity");

            ownershipLog[ID] = msg.sender;
            mintLogs[ID] = true;
            return done;
        }

        function getItemOwner (string calldata ID) view public returns (address) {
            return ownershipLog[ID];
        }

        
        function transferItem (string calldata ID, address _to) public returns (string memory successfull) {
            require(ownershipLog[ID] == msg.sender, "This item does not belong to you");

            transferLogs[ID].push(_to);
            ownershipHistoryCount[ID] += 1;
            ownershipLog[ID] = _to;
            return successfull;
        }

        function itemOwnershipHistoryCount (string calldata ID) view public returns (uint) {
            return ownershipHistoryCount[ID];
        }

        function itemHistoricOwnership (string calldata ID) view public returns (address[] memory) {
            return transferLogs[ID];
        }

    }
  
    // Ensure Ethereum is enabled
    window.ethereum.enable();

    var ContractAdd = "0x4815A8Ba613a3eB21A920739dE4cA7C439c7e1b1";
    var ContractABI = [
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "ID",
				"type": "string"
			}
		],
		"name": "setItem",
		"outputs": [
			{
				"internalType": "string",
				"name": "done",
				"type": "string"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "ID",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "_to",
				"type": "address"
			}
		],
		"name": "transferItem",
		"outputs": [
			{
				"internalType": "string",
				"name": "successfull",
				"type": "string"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "ID",
				"type": "string"
			}
		],
		"name": "getItemOwner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "ID",
				"type": "string"
			}
		],
		"name": "itemHistoricOwnership",
		"outputs": [
			{
				"internalType": "address[]",
				"name": "",
				"type": "address[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "ID",
				"type": "string"
			}
		],
		"name": "itemOwnershipHistoryCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]

  var assetContract;
  var signer;

  var provider = new ethers.providers.Web3Provider(window.ethereum);
  provider.listAccounts().then(function(accounts) {
      signer = provider.getSigner(accounts[0]);
      assetContract = new ethers.Contract(ContractAdd, ContractABI, signer);
    })

// Calling smart contract(s)

async function getItemOwner() {
   const accounts = await window.ethereum.request({method: "eth_accounts"}); 
    if (accounts.length){
      let ID = prompt('Input Asset Identification Number');
        if (ID.length){
          getItemOwnerPromise = assetContract.getItemOwner(ID);
          var itemOwner = await getItemOwnerPromise;
          setTimeout(function(){alert(`This item belongs to ${itemOwner}`)}, 250);
          //console.log(item);
    } else{
        alert("Please the input section can not be blank");
    }
    } else{
        setTimeout(function(){alert ("Please connect your wallet")}, 250);
    }
}
  </script>

</body>

</html>